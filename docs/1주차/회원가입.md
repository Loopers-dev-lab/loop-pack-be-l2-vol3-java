# 실습: 회원가입 기능

## 요구사항

- 필요 정보: 로그인 ID, 비밀번호, 이름, 생년월일, 이메일
- 이미 가입된 로그인 ID로는 가입이 불가능함
- 각 정보는 포맷에 맞는 검증 필요 (이름, 이메일, 생년월일)
- 비밀번호는 암호화해 저장
- 비밀번호는 다음과 같은 규칙을 가짐
  1. 8~16자의 영문 대소문자, 숫자, 특수문자만 가능합니다.
  2. 생년월일은 비밀번호 내에 포함될 수 없습니다.

---

## TDD 진행 순서 (Inside-Out)
- Inside-Out 방식이 TDD를 처음 제안한 Kent Beck의 접근에 가깝다고함. 가장 작은 단위부터 테스트를 작성하 점차 바깥 레이어로 조합해나가는
- 회원가입 기능에 대한 요구사항을 layer 별로 나누고 테스트 목록을 추출하자.
- 전체 프로세스 : 요구사항 -> 레이어별 분리 -> 테스트 목록 추출 -> 테스트 코드 작성 -> 점진적 완성

### 1단계 : 요구사항 레이어별 분리

#### Domain

- 비밀번호 규칙 검증

#### Service

- 정상 입력 시 회원가입 성공
- 이미 가입된 로그인 ID로는 가입이 불가능
- 비밀번호가 암호화되어 저장

#### Controller/DTO

- 회원 가입 시 사용자는 id, 비밀번호, 이름, 생년월일, email을 입력 검증
- 이메일 형식 불일치시 실패
- 생년월일 형식 불일치시 실패

### 2단계 : 요구사항을 기반으로 테스트 목록을 추출한다.

#### Domain (User)
- [x] 비밀번호가 8자 미만이면 예외 발생
- [x] 비밀번호가 16자 초과하면 예외 발생
- [x] 비밀번호에 허용되지 않는 문자 포함 시 예외 발생
- [x] 비밀번호에 생년월일 포함 시 예외 발생

#### Service
- [x] 정상 입력 시 회원가입 성공
- [x] 중복 가입된 ID 입력 시 예외 발생
- [x] 비밀번호가 암호화되어 저장된다

#### Controller / DTO
- [ ] 필수값 미입력 실패(loginId, password, name, birthDate, email)
- [ ] 이메일 형식 불일치 시 실패
- [ ] 생년월일 형식(yyyyMMdd) 불일치 시 실패

### 3단계: 테스트 코드 작성 + 구현
- 단위 테스트

### 4단계: 통합 테스트 작성                                                                                                                                                                                                          

### 5단계: E2E 테스트 작성

## 문제점
### 1. 비밀번호 유효성 검증은 누구의 책임인가??
도메인은 자신의 상태가 불완전해지지 않도록 보호할 책임을 갖고 있다고 생각한다.
불완전한 비밀번호를 갖고 있지 않기 위해 새로운 엔티티 생성 시 비밀번호 유효성 검증을 도메인에게 맡겼다.
이렇게 하다보니 암호화된 비밀번호를 도메인에 전달하고 영속화하려는 경우 비밀번호의 길이 제한 유효성 검증에 걸리게 되는 문제가 발생한다.
어떻게 수정해야할까?

